<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Request - E-Pantok</title>
    <style>
        body { font-family: Arial, Helvetica, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
        .header { background-color: #1976d2; color: #fff; padding: 30px 10px; text-align: center; font-size: 2.2rem; letter-spacing: 1px; }
        .container { max-width: 420px; margin: 40px auto 0 auto; background: #fff; border-radius: 16px; box-shadow: 0 8px 32px rgba(25,118,210,0.12); padding: 40px 32px 32px 32px; }
        .modern-btn { background: #1976d2; color: #fff; border: none; border-radius: 10px; padding: 16px 32px; font-size: 1.15rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 16px rgba(25,118,210,0.10); transition: background 0.2s, box-shadow 0.2s; display: block; margin: 0 auto; }
        .modern-btn:hover { background: #1565c0; box-shadow: 0 6px 24px rgba(25,118,210,0.16); }
        .footer { margin-top: 48px; }
        h1 { margin-top: 0; color: #1976d2; text-align: center; font-size: 1.7rem; }
        form { display: flex; flex-direction: column; gap: 14px; }
        label { font-weight: 500; color: #1976d2; margin-bottom: 4px; }
        input[type="text"] { padding: 10px; border-radius: 6px; border: 1px solid #bdbdbd; font-size: 1rem; background: #f9f9f9; transition: border 0.2s; }
        input[type="text"]:focus { border: 1.5px solid #1976d2; outline: none; background: #e3f2fd; }
        input[type="submit"] { background: #1976d2; color: #fff; border: none; border-radius: 8px; padding: 14px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; transition: background 0.2s, box-shadow 0.2s; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.08); }
        input[type="submit"]:hover { background: #1565c0; box-shadow: 0 2px 8px rgba(25, 118, 210, 0.15); }
        .status-box { margin-top: 24px; padding: 18px; border-radius: 8px; background: #e3f2fd; color: #1976d2; font-size: 1.1rem; text-align: center; display: none; }
        /* Visitor-friendly status badges */
        .status-badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:600; font-size:0.95rem; color:#fff; }
        .status-ready { background:#2e7d32; } /* green */
        .status-pending { background:#d32f2f; } /* red */
        .status-other { background:#6c6c6c; } /* gray */
        .status-legend { margin-top:12px; text-align:center; font-size:0.95rem; color:#555; }
        .footer { background-color: #f1f1f1; padding: 10px; text-align: center; margin-top: 40px; font-size: 1rem; color: #888; }
        .back-link { display: block; text-align: center; margin-top: 22px; color: #1976d2; text-decoration: none; font-weight: 500; transition: color 0.2s; }
        .back-link:hover { color: #0d47a1; text-decoration: underline; }
    </style>
    <script>
        // Map internal statuses to visitor-friendly labels & css
        function visitorStatusLabel(status) {
            const s = (status || '').toLowerCase();
            if (s.includes('ready') || s.includes('completed')) return {label: 'Ready to claim', cls: 'status-ready'};
            if (s.includes('pending') || s.includes('process')) return {label: 'Pending', cls: 'status-pending'};
            return {label: status || 'Pending', cls: 'status-other'};
        }

        // Render a single visitor-facing badge in the status box (green or red)
        function renderSingleBadge(status) {
            const statusBox = document.getElementById('status-box');
            const vs = visitorStatusLabel(status);
            statusBox.innerHTML = `<div style="text-align:center;"><span id="single-badge" class="status-badge ${vs.cls}" title="${status}">${vs.label}</span>` +
                (vs.cls === 'status-ready' ? `<div style='margin-top:8px;color:#2e7d32;font-weight:600;'>Your request is ready for pickup. Please bring a valid ID when claiming.</div>` : `</div>`);
            statusBox.style.display = 'block';
        }

        // Enhanced status tracking: simplified for visitors — show single badge on check
        function checkStatus(event) {
            event.preventDefault();
            const name = document.getElementById('name').value.trim().toLowerCase();
            const ref = document.getElementById('ref').value.trim();
            const statusBox = document.getElementById('status-box');
            statusBox.innerHTML = '';
            statusBox.style.display = 'none';
            // Get all requests from localStorage
            const requests = JSON.parse(localStorage.getItem('requests') || '[]');
            // Find matching requests
            const matches = requests.filter(r =>
                (name && r.name && r.name.toLowerCase() === name) ||
                (ref && r.ref && r.ref === ref)
            );
            if (matches.length > 0) {
                // If any matched request is ready/completed - show green, else show red pending
                const isReady = matches.some(r => (r.status || '').toLowerCase().includes('ready') || (r.status || '').toLowerCase().includes('completed'));
                if (isReady) renderSingleBadge('Ready for Pickup');
                else renderSingleBadge('Pending');
            } else {
                statusBox.textContent = 'No request found for the given details.';
                statusBox.style.display = 'block';
            }
            // show any notifications for the entered name/ref
            showNotifications();
        }

        // Simulate admin login (for demo, checks localStorage)
        function isAdmin() {
            return localStorage.getItem('isAdmin') === 'true';
        }

        // Allow admin to update status (demo only)
        function updateStatus(idx, newStatus) {
            const requests = JSON.parse(localStorage.getItem('requests') || '[]');
            if (requests[idx]) {
                requests[idx].status = newStatus;
                localStorage.setItem('requests', JSON.stringify(requests));
                // update visitor-facing badge for list items (if present)
                const el = document.getElementById('status-' + idx);
                if (el) {
                    const vs = visitorStatusLabel(newStatus);
                    el.textContent = vs.label;
                    el.className = 'status-badge ' + vs.cls;
                    el.title = newStatus;
                }
                // if the single visitor badge is visible, update it too
                if (document.getElementById('single-badge')) renderSingleBadge(newStatus);
                // Simulate notification (email/SMS)
                addNotification(requests[idx], newStatus);
                showNotifications();
            }
        }

        // Add notification to localStorage
        function addNotification(request, status) {
            const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
            const now = new Date();
            notifications.push({
                name: request.name,
                ref: request.ref,
                service: request.service,
                status,
                time: now.toLocaleString(),
                type: 'Email/SMS (simulated)'
            });
            localStorage.setItem('notifications', JSON.stringify(notifications));
        }

        // Show notification history for user
        function showNotifications() {
            const name = document.getElementById('name').value.trim().toLowerCase();
            const ref = document.getElementById('ref').value.trim();
            const notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
            const filtered = notifications.filter(n =>
                (name && n.name && n.name.toLowerCase() === name) ||
                (ref && n.ref && n.ref === ref)
            );
            const notifBox = document.getElementById('notif-box');
            if (!notifBox) return;
            if (filtered.length > 0) {
                notifBox.innerHTML = '<h3 style="color:#1976d2;margin-bottom:8px;">Notifications</h3>' +
                    filtered.map(n => `<div style='background:#fff3e0;border-radius:8px;padding:10px;margin-bottom:8px;font-size:0.98rem;'><strong>${n.type}</strong> - ${n.status}<br><span style='color:#888;'>${n.time}</span></div>`).join('');
                notifBox.style.display = 'block';
            } else {
                notifBox.innerHTML = '';
                notifBox.style.display = 'none';
            }
        }
    </script>
</head>
<body>
    <div class="header">Track Your Request</div>
    <div class="container">
        <h1>Track Request</h1>
        <form onsubmit="checkStatus(event)">
            <label for="name">Full Name:</label>
            <input type="text" id="name" name="name" placeholder="Enter your full name" oninput="showNotifications()">
            <label for="ref">Reference Number:</label>
            <input type="text" id="ref" name="ref" placeholder="Enter your reference number" oninput="showNotifications()">
            <input type="submit" value="Check Status">
            <div style="font-size:0.95rem;color:#888;margin-top:8px;">You may enter either your full name or reference number.</div>
        </form>
        <div class="status-box" id="status-box"></div>
        <div class="status-legend" id="status-legend"><span class="status-badge status-ready">Ready to claim</span>&nbsp;<span class="status-badge status-pending">Pending</span></div>
    <div id="notif-box" style="display:none;margin-top:18px;"></div>
        <a class="back-link" href="index.html">← Back to Home</a>
        
    </div>
    <div class="footer">&copy; 2025 E-Pantok. All rights reserved.</div>
</body>
</html>
